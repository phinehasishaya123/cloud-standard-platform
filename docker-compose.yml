services:
      production-website:
        build: ./app
        #container_name: production-website_worker
        restart: always
        expose:
          - "5000"
        deploy:
          replicas: 1 # ðŸ‘ˆ CRITICAL: Run 3 copies of the app
        environment:
          DB_HOST: company-database
          POSTGRES_DB: ${DB_NAME}
          POSTGRES_USER: ${DB_USER}
          POSTGRES_PASSWORD: ${DB_PASSWORD}
        depends_on:
          company-database:
            condition: service_healthy

      nginx:
        image: nginx:latest
        container_name: nginx
        # Expose both HTTP (80) and HTTPS (443)
        ports:
          - "80:80"
          - "443:443"
        # Mount the custom config file and the SSL certificates
        volumes:
          - ./nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf:ro
          - ./nginx/certs:/etc/nginx/certs:ro
        healthcheck:
          test: ["CMD", "nginx", "-t"]
          interval: 30s
          timeout: 10s
          retries: 3
          start_period: 5s


      company-database:
        image: postgres:13-alpine
        container_name: company-database
        # ... (rest of the DB config remains the same) ...
        restart: always
        volumes:
          - company_data:/var/lib/postgresql/data
        environment:
          POSTGRES_DB: ${DB_NAME}
          POSTGRES_USER: ${DB_USER}
          # ENSURE this password matches the one in production-website environment block!
          POSTGRES_PASSWORD: ${DB_PASSWORD}
        healthcheck:
          test: ["CMD-SHELL", "pg_isready -U user"]
          interval: 5s
          timeout: 5s
          retries: 5
      monitoring-dashboard:
        image: louislam/uptime-kuma:1
        container_name: monitoring-dashboard
        restart: always
        ports:
          - "3001:3001"
        volumes:
          - /home/phinehas/monitoring-data:/app/data
      caching-layer:
        image: redis:6-alpine
        container_name: caching-layer
        restart: always
        volumes:
          - redis_data:/data # Volume for persistent Redis data
        command: redis-server --appendonly yes # Use AOF for data persistence
          
volumes: 
  company_data:    
      # ... (monitoring-dashboard service remains the same) ...
  redis_data: # ðŸ‘ˆ New Redis volume
