services:
      production-website:
        build: ./app
        #container_name: production-website_worker
        restart: always
        expose:
          - "5000"
        deploy:
          replicas: 3 # ðŸ‘ˆ CRITICAL: Run 3 copies of the app
        environment:
          DB_HOST: company-database
          POSTGRES_DB: ${DB_NAME}
          POSTGRES_USER: ${DB_USER}
          POSTGRES_PASSWORD: ${DB_PASSWORD}
        depends_on:
          company-database:
            condition: service_healthy

      nginx:
        image: nginx:stable-alpine
        container_name: production-nginx
        restart: always
        ports:
          - "80:80" # ðŸ‘ˆ Nginx is now the internet-facing component on Port 80
        volumes:
          - ./nginx/nginx.conf:/etc/nginx/conf.d/default.conf # ðŸ‘ˆ Mount our config
        depends_on:
          - production-website # ðŸ‘ˆ Make sure the apps are ready before Nginx starts
      company-database:
        image: postgres:13-alpine
        container_name: company-database
        # ... (rest of the DB config remains the same) ...
        restart: always
        volumes:
          - company_data:/var/lib/postgresql/data
        environment:
          POSTGRES_DB: ${DB_NAME}
          POSTGRES_USER: ${DB_USER}
          # ENSURE this password matches the one in production-website environment block!
          POSTGRES_PASSWORD: ${DB_PASSWORD}
        healthcheck:
          test: ["CMD-SHELL", "pg_isready -U user"]
          interval: 5s
          timeout: 5s
          retries: 5
      monitoring-dashboard:
        image: louislam/uptime-kuma:1
        container_name: monitoring-dashboard
        restart: always
        ports:
          - "3001:3001"
        volumes:
          - /home/phinehas/monitoring-data:/app/data

volumes: 
  company_data:    
      # ... (monitoring-dashboard service remains the same) ...
