# This configuration defines a server block that acts as a load balancer
    # and reverse proxy for the Flask application.

    # Defines the group of application servers (Flask app containers)
    upstream app_servers {
        # Docker Compose automatically assigns hostnames like service_1, service_2, etc.
        # We target the service name 'production-website' and Nginx will find all copies.
        server production-website:5000;
        server production-website:5000;
        server production-website:5000;
    }

    server {
        listen 80;
        server_name _;

        # Routes requests to the application servers
        location / {
            # Use Round-Robin Load Balancing to distribute requests evenly
            proxy_pass http://app_servers;
            
            # Standard headers for proxying
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # If you were to add other paths (like /static, /admin, etc.)
        # they would go here.
    }
